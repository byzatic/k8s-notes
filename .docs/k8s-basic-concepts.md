# Базовые концепции Kubernetes — Академическое изложение

## Введение

Kubernetes (часто сокращённо K8s) представляет собой распределённую платформу оркестрации контейнеров с открытым исходным кодом, предназначенную для автоматизации развёртывания, масштабирования и управления контейнеризованными приложениями. Архитектура Kubernetes основана на ряде фундаментальных объектов и абстракций, которые взаимодействуют для обеспечения высокой доступности, эластичности и управляемости приложений в распределённой среде.

---

## 1. Namespace (пространство имён)

**Определение:** Namespace является логической единицей изоляции ресурсов внутри кластера Kubernetes. Он используется для группировки объектов и разграничения их видимости, а также для применения политик управления ресурсами.

**Назначение:**
- Разделение окружений (например, *development*, *staging*, *production*).
- Организация ресурсов по проектам или командам.
- Применение квот (`ResourceQuota`) и лимитов (`LimitRange`) для контроля потребления ресурсов.

**Ключевая особенность:** Объекты, расположенные в различных пространствах имён, могут иметь одинаковые имена, поскольку идентифицируются парой «namespace/имя».

---

## 2. Pod

**Определение:** Pod является минимальной единицей развертывания в Kubernetes. Он представляет собой один или несколько контейнеров, которые совместно используют сетевой стек, пространство имён процессов (опционально) и подсистемы хранения (volumes).

**Функции:**
- Обеспечение изоляции уровня контейнеров в рамках логической единицы.
- Сопровождение вспомогательных контейнеров (*sidecar*, *init containers*) наряду с основным приложением.
- Обеспечение согласованной среды исполнения для группы контейнеров.

**Жизненный цикл:** Pod является эфемерным; при его удалении или сбое он не восстанавливается напрямую, а воспроизводится управляющими объектами (например, Deployment).

---

## 3. Deployment

**Определение:** Deployment — контроллер более высокого уровня, обеспечивающий декларативное управление множеством Pod’ов через промежуточный объект ReplicaSet. Deployment гарантирует соответствие текущего состояния кластера заданному пользователем описанию (манифесту).

**Возможности:**
- Масштабирование числа реплик.
- Пошаговое обновление приложения (*rolling update*).
- Откат к предыдущей версии конфигурации (*rollback*).
- Автоматическое восстановление в случае сбоев.

**Принцип работы:** Deployment управляет ReplicaSet, который, в свою очередь, гарантирует наличие требуемого числа Pod’ов, соответствующих определённым меткам (labels).

---

## 4. Service

**Определение:** Service представляет собой абстракцию, обеспечивающую стабильную сетевую идентичность и доступ к набору Pod’ов. Основная задача Service — устранение зависимости клиентов от изменяющихся IP-адресов Pod’ов.

**Основные типы Service:**
- **ClusterIP** — доступен только внутри кластера (по умолчанию).
- **NodePort** — предоставляет доступ извне через IP-адрес узла и статический порт.
- **LoadBalancer** — интегрируется с внешними балансировщиками облачных провайдеров.
- **Headless Service** — (`clusterIP: None`) используется для прямого взаимодействия с каждым Pod’ом, часто в контексте StatefulSet.
- **ExternalName** — разрешает DNS-имя во внешний адрес без проксирования трафика.

**Механизм работы:** kube-proxy конфигурирует правила маршрутизации (iptables или IPVS) на каждом узле для перенаправления трафика, поступающего на Service, к соответствующим Pod’ам.

---

## 5. ReplicaSet

**Определение:** ReplicaSet обеспечивает поддержание фиксированного числа идентичных Pod’ов, доступных для обработки нагрузки.

**Назначение:**
- Гарантированное количество активных реплик приложения.
- Автоматическое создание/удаление Pod’ов при изменении нагрузки или сбоях.

**Связь с Deployment:** В большинстве случаев ReplicaSet управляется Deployment и не создаётся пользователем напрямую.

---

## 6. ConfigMap и Secret

**ConfigMap** — объект для хранения небинарных конфигурационных данных в виде пар ключ-значение.  
**Secret** — аналогичный объект для хранения конфиденциальных данных, кодированных в base64.

**Использование:**
- Передача конфигураций и секретов в контейнеры через переменные окружения или тома.
- Декларативное определение конфигурационных параметров.

---

## 7. Volume и PersistentVolume

**Volume** — абстракция для хранения данных, доступная контейнерам в Pod’е.  
**PersistentVolume (PV)** — объект, представляющий собой независимый от жизненного цикла Pod’а блок или файловую систему, управляемый администратором.  
**PersistentVolumeClaim (PVC)** — запрос пользователя на использование PV.

**Значение:** Обеспечивает долговременное хранение данных в кластере.

---

## 8. Control Plane и Worker Nodes

**Control Plane** — совокупность компонентов, управляющих состоянием кластера:
- **kube-apiserver** — центральная точка взаимодействия с кластером через API.
- **etcd** — распределённое хранилище состояния кластера.
- **kube-scheduler** — планировщик размещения Pod’ов на узлах.
- **kube-controller-manager** — набор контроллеров, управляющих состоянием объектов.

**Worker Node** — вычислительные узлы, исполняющие контейнеры:
- **kubelet** — агент, управляющий Pod’ами на узле.
- **kube-proxy** — обеспечивает сетевую маршрутизацию для Service.
- Среда выполнения контейнеров (container runtime) — например, containerd, CRI-O.

---

## 9. Маршрутизация и DNS

В Kubernetes DNS-служба (обычно CoreDNS) автоматически регистрирует имена Service, позволяя обращаться к ним по FQDN в формате:  
```
<service>.<namespace>.svc.cluster.local
```

**Преимущество:** Автоматическая интеграция с Service Discovery внутри кластера.

---

## 10. Политики безопасности и ограничения

- **NetworkPolicy** — определяет правила сетевого взаимодействия между Pod’ами.
- **PodSecurity Standards / Admission Controllers** — ограничение возможностей Pod’ов на уровне безопасности.
- **RBAC (Role-Based Access Control)** — модель разграничения прав доступа к API Kubernetes.

---

## Заключение

Kubernetes предоставляет мощный и гибкий набор абстракций для управления жизненным циклом контейнеризованных приложений в распределённой среде. Понимание базовых объектов — Namespace, Pod, Deployment, Service, а также механизмов работы Control Plane и узлов — является необходимым условием для эффективного проектирования, развёртывания и сопровождения приложений в производственных кластерах.

